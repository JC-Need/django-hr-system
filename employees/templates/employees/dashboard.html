<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR & Bonus System Dashboard</title>
    <style>
        /* --- CSS ‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö --- */
        body { font-family: 'Sarabun', sans-serif; background-color: #f4f7f6; margin: 0; padding: 20px; }
        .container { max-width: 1300px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 30px; }
        h2 { color: #2c3e50; margin-bottom: 15px; border-left: 5px solid #007bff; padding-left: 10px; }
        
        /* ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ */
        .btn-group { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; align-items: center; }
        .btn { padding: 8px 15px; text-decoration: none; border-radius: 6px; color: white; font-weight: bold; border: none; cursor: pointer; display: inline-block; font-size: 14px;}
        .btn-add { background-color: #28a745; }
        .btn-calc { background-color: #007bff; }
        .btn-admin { background-color: #6c757d; }
        .btn-leave { background-color: #ffc107; color: black; } /* ‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏•‡∏≤ */
        .btn-logout { background-color: #dc3545; } /* ‡∏õ‡∏∏‡πà‡∏° Logout ‡∏™‡∏µ‡πÅ‡∏î‡∏á */
        .btn:hover { opacity: 0.9; }

        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á (Filter Box) */
        .filter-box {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            border: 1px solid #e9ecef;
        }
        .filter-label { font-weight: bold; margin-right: 10px; color: #495057; }
        .filter-select { padding: 8px; border-radius: 5px; border: 1px solid #ced4da; cursor: pointer; min-width: 200px; }

        /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background-color: #343a40; color: white; padding: 15px; text-align: left; }
        td { padding: 15px; border-bottom: 1px solid #ddd; vertical-align: middle; }
        tr:hover { background-color: #f1f1f1; }

        /* ‡∏õ‡πâ‡∏≤‡∏¢‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Badge) */
        .status-badge { padding: 5px 10px; border-radius: 20px; font-size: 0.85em; font-weight: bold; display: inline-block; }
        .status-active { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status-resigned { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

        .emp-name { font-weight: bold; color: #2c3e50; }
        .bonus-amount { font-weight: bold; color: #28a745; }
        
        /* ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Font */
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap');
    </style>
</head>
<body>

    <div class="container">
        <h1>üè¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (HR System)</h1>

        <div class="btn-group">
            <a href="/leave_request/" class="btn btn-leave" target="_blank">üìù ‡∏¢‡∏∑‡πà‡∏ô‡πÉ‡∏ö‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢/‡∏Å‡∏¥‡∏à</a>
            <a href="/admin/employees/employee/add/" class="btn btn-add" target="_blank">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</a>
            <a href="/admin/" class="btn btn-admin" target="_blank">‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</a>
            
            <form action="{% url 'calculate_bonus' %}" method="post" style="margin:0;">
                {% csrf_token %}
                <button type="submit" class="btn btn-calc">üí∞ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ</button>
            </form>

            <form action="{% url 'logout' %}" method="post" style="margin:0;">
                {% csrf_token %}
                <button type="submit" class="btn btn-logout">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </form>
        </div>

        <div class="filter-box">
            <span class="filter-label">üìÇ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡∏π‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å:</span>
            <form method="get" style="margin: 0;">
                <select name="dept" class="filter-select" onchange="this.form.submit()">
                    <option value="">-- ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (All Departments) --</option>
                    {% for dept in department_list %}
                        <option value="{{ dept }}" {% if dept == selected_dept %}selected{% endif %}>
                            {{ dept }}
                        </option>
                    {% endfor %}
                </select>
            </form>
        </div>

        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>‡∏£‡∏´‡∏±‡∏™</th>
                        <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                        <th>‡πÅ‡∏ú‡∏ô‡∏Å</th>
                        <th>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        <th style="text-align: center;">‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (Time)</th>
                        <th>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</th>
                        <th>‡πÇ‡∏ö‡∏ô‡∏±‡∏™ (‡∏ö‡∏≤‡∏ó)</th>
                        <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody>
                    {% for emp in employees %}
                    <tr>
                        <td>{{ emp.emp_id|default:"-" }}</td>
                        <td class="emp-name">{{ emp.name }}</td>
                        <td>{{ emp.department|default:"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏" }}</td>
                        <td>{{ emp.position }}</td>
                        
                        <td>
                            {% if emp.status == 'ACTIVE' %}
                                <span class="status-badge status-active">{{ emp.get_status_display }}</span>
                            {% else %}
                                <span class="status-badge status-resigned">{{ emp.get_status_display }}</span>
                            {% endif %}
                        </td>

                        <td style="text-align: center;">
                            {% if not emp.today_attendance %}
                                <a href="{% url 'attendance_action' emp.id %}" class="btn" style="background-color: #28a745; font-size: 0.8em;">üïí ‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô</a>
                            {% elif not emp.today_attendance.time_out %}
                                <div style="margin-bottom: 5px; font-size: 0.8em; color: green; font-weight: bold;">‡πÄ‡∏Ç‡πâ‡∏≤: {{ emp.today_attendance.time_in|time:"H:i" }}</div>
                                <a href="{% url 'attendance_action' emp.id %}" class="btn" style="background-color: #ffc107; color: black; font-size: 0.8em;">üèÉ ‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô</a>
                            {% else %}
                                <div style="font-size: 0.85em; color: #444;">
                                    <div>üü¢ {{ emp.today_attendance.time_in|time:"H:i" }}</div>
                                    <div>üî¥ {{ emp.today_attendance.time_out|time:"H:i" }}</div>
                                    <div style="color: blue; font-weight: bold; font-size: 0.8em;">‚úÖ ‡∏Ñ‡∏£‡∏ö</div>
                                </div>
                            {% endif %}
                        </td>

                        <td>{{ emp.formatted_salary }}</td>
                        <td class="bonus-amount">‡∏ø {{ emp.bonus_amount }}</td>
                        <td>
                            <a href="/admin/employees/employee/{{ emp.id }}/change/" target="_blank" style="color: #007bff; text-decoration: none;">‚úé ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="9" style="text-align: center; color: #999; padding: 30px;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å‡∏ô‡∏µ‡πâ</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <br><hr style="border-top: 2px dashed #bbb;"><br>

        <h2>üìÖ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏•‡∏≤‡∏á‡∏≤‡∏ô (Leave Requests)</h2>
        
        <div style="overflow-x: auto; margin-bottom: 50px;">
            <table>
                <thead>
                    <tr style="background-color: #17a2b8;"> <th style="background-color: #17a2b8;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡πà‡∏ô</th>
                        <th style="background-color: #17a2b8;">‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</th>
                        <th style="background-color: #17a2b8;">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤</th>
                        <th style="background-color: #17a2b8;">‡∏•‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                        <th style="background-color: #17a2b8;">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</th>
                        <th style="background-color: #17a2b8;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        <th style="background-color: #17a2b8;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody>
                    {% for leave in leaves %}
                    <tr>
                        <td>{{ leave.created_at|date:"d M Y" }}</td>
                        <td style="font-weight: bold;">{{ leave.employee.name }}</td>
                        <td>
                            {% if leave.leave_type == 'SICK' %} ü§í ‡∏õ‡πà‡∏ß‡∏¢
                            {% elif leave.leave_type == 'VACATION' %} üèñÔ∏è ‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô
                            {% else %} üíº ‡∏Å‡∏¥‡∏à‡∏ò‡∏∏‡∏£‡∏∞
                            {% endif %}
                        </td>
                        <td>{{ leave.start_date|date:"d/m/y" }} - {{ leave.end_date|date:"d/m/y" }}</td>
                        <td style="color: #666; font-style: italic;">"{{ leave.reason }}"</td>
                        <td>
                            {% if leave.status == 'APPROVED' %}
                                <span class="status-badge status-active">üü¢ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</span>
                            {% elif leave.status == 'REJECTED' %}
                                <span class="status-badge status-resigned">üî¥ ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>
                            {% else %}
                                <span class="status-badge" style="background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba;">üü° ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="/admin/employees/leaverequest/{{ leave.id }}/change/" target="_blank" style="text-decoration: none; font-weight: bold; color: #007bff;">üìù ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" style="text-align: center; color: #999; padding: 20px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏•‡∏≤‡∏´‡∏¢‡∏∏‡∏î</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </div>

</body>
</html>